"use strict";var C=Object.create;var O=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var $=Object.getPrototypeOf,W=Object.prototype.hasOwnProperty;var F=(r,e)=>{for(var t in e)O(r,t,{get:e[t],enumerable:!0})},j=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of L(e))!W.call(r,a)&&a!==t&&O(r,a,{get:()=>e[a],enumerable:!(n=V(e,a))||n.enumerable});return r};var T=(r,e,t)=>(t=r!=null?C($(r)):{},j(e||!r||!r.__esModule?O(t,"default",{value:r,enumerable:!0}):t,r)),X=r=>j(O({},"__esModule",{value:!0}),r);var ce={};F(ce,{Graph:()=>c,THREE:()=>ie,apply:()=>x,clearAll:()=>m,createNode:()=>s,dslContext:()=>f,executeDSL:()=>w,getObjectRegistry:()=>A,map:()=>i,parseDSL:()=>D,setScene:()=>v});module.exports=X(ce);var o=T(require("three"));var Y=require("three");function E(r,e){return r.rotateX(e)}function g(r,e){return r.rotateY(e)}function h(r,e){return r.rotateZ(e)}function R(r,e){return r.translateX(e)}function N(r,e){return r.translateY(e)}function H(r,e){return r.translateZ(e)}var l=class{constructor(e={}){this.visited=new Set;this.options={showIds:e.showIds??!0,maxDepth:e.maxDepth??10,nodeLabel:e.nodeLabel??this.defaultNodeLabel.bind(this),showDependencyCount:e.showDependencyCount??!0}}defaultNodeLabel(e){let t=e.compute.toString();return t.includes("SphereGeometry")?"sphere":t.includes("BoxGeometry")?"box":t.includes("CylinderGeometry")?"cylinder":t.includes("MeshBasicMaterial")?"material":t.includes("THREE.Mesh")||t.includes("new THREE.Mesh")?"mesh":t.includes("translateXObj")?"translateX":t.includes("translateYObj")?"translateY":t.includes("translateZObj")?"translateZ":t.includes("rotateXObj")?"rotateX":t.includes("rotateYObj")?"rotateY":t.includes("rotateZObj")?"rotateZ":t.includes("currentScene.add")||t.includes("objectRegistry")?"render":t.includes("Graph.run")?"map":"node"}print(e,t=0){let n="  ".repeat(t),a=this.options.showIds?` (${e.id})`:"",B=this.options.showDependencyCount?` [deps: ${e.dependencies.length}]`:"",P=this.options.nodeLabel(e),u=`${n}${P}${a}${B}
`;if(t>=this.options.maxDepth)return u+`${n}  ...(max depth reached)
`;if(this.visited.has(e.id))return u+`${n}  ...(already visited)
`;this.visited.add(e.id);for(let b=0;b<e.dependencies.length;b++){let S=e.dependencies[b],y=b===e.dependencies.length-1?"\u2514\u2500 ":"\u251C\u2500 ";u+=`${n}${y}`,u+=this.print(S,t+1).slice(n.length+y.length)}return u}printForest(e){this.visited.clear();let t="";for(let n=0;n<e.length;n++)n>0&&(t+=`
`),t+=`Root ${n+1}:
`,t+=this.print(e[n]);return t}compact(e){let t=this.options.nodeLabel(e),n=e.dependencies.map(a=>this.compact(a)).join(", ");return n?`${t}(${n})`:t}};var Z=0,G=()=>`node-${++Z}`,s=(r,e=[])=>({id:G(),compute:r,dependencies:e}),M=r=>{let e=r.dependencies.map(t=>M(t));return r.compute(...e)},i=r=>e=>s(r,[e]),x=(r,e)=>s(r,e);var I=(r,e)=>new l(e).print(r),Q=(r,e)=>new l(e).compact(r),c=class{};c.run=M,c.prettyPrint=I,c.compact=Q;var p=null,d=new Map;function v(r){p=r}function A(){return d}function m(){p&&d.forEach(r=>{p.remove(r),r instanceof o.Mesh&&(r.geometry.dispose(),r.material instanceof o.Material&&r.material.dispose())}),d.clear(),console.log("Cleared all objects from scene and registry")}var k=(r=1,e=32,t=16)=>s(()=>new o.SphereGeometry(r,e,t)),q=(r=1,e=1,t=1)=>s(()=>new o.BoxGeometry(r,e,t)),J=(r=1,e=1,t=1)=>s(()=>new o.CylinderGeometry(r,e,t)),U=(r={})=>s(()=>{let e={color:65280,wireframe:!1};return new o.MeshBasicMaterial({...e,...r})}),z=(r,e)=>x((t,n)=>new o.Mesh(t,n),[r,e]),K=(r,e)=>i(t=>(R(t,e),t))(r),_=(r,e)=>i(t=>(N(t,e),t))(r),ee=(r,e)=>i(t=>(H(t,e),t))(r),te=(r,e)=>i(t=>(E(t,e),t))(r),re=(r,e)=>i(t=>(g(t,e),t))(r),ne=(r,e)=>i(t=>(h(t,e),t))(r),oe=(r,e)=>i(t=>{if(!p)return console.warn("No scene available for rendering"),t;let n=d.get(e);return n?(n.position.copy(t.position),n.rotation.copy(t.rotation),n.scale.copy(t.scale),n instanceof o.Mesh&&t instanceof o.Mesh&&(n.geometry.dispose(),n.geometry=t.geometry,n.material instanceof o.Material&&n.material.dispose(),n.material=t.material),console.log(`Updated existing object: ${e}`),n):(p.add(t),d.set(e,t),console.log(`Created new object: ${e}`),t)})(r),f={sphere:k,box:q,cylinder:J,material:U,mesh:z,translateX:K,translateY:_,translateZ:ee,rotateX:te,rotateY:re,rotateZ:ne,render:oe,clearAll:m,Graph:c,Math,console};function D(r){try{return new Function(...Object.keys(f),`return ${r}`)(...Object.values(f))}catch(e){return console.error("DSL parsing error:",e),null}}function w(r){try{let e=D(r);if(e&&typeof e=="object"&&"compute"in e){let t=c.run(e);return t instanceof o.Object3D?t:null}return e instanceof o.Object3D?e:null}catch(e){return console.error("DSL execution error:",e),null}}var ie=T(require("three"));0&&(module.exports={Graph,THREE,apply,clearAll,createNode,dslContext,executeDSL,getObjectRegistry,map,parseDSL,setScene});
